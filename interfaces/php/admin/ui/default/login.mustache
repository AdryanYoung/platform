<!DOCTYPE html>

<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<!-- Set the viewport width to device width for mobile -->
	<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />

	<title>CASH Music / Admin</title>

	<link rel="icon" href="{{img_base_url}}/ui/default/assets/images/favicon.ico" type="image/x-icon" />
	<link href='//fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
	<link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
	<link href="{{www_path}}/ui/default/assets/css/foundation.min.css" rel="stylesheet" type="text/css" />
	<link href="{{www_path}}/ui/default/assets/css/app.css" rel="stylesheet" type="text/css" />
	<link href="{{www_path}}/ui/default/assets/css/offcanvas.css" rel="stylesheet" type="text/css" />
	<link href="{{www_path}}/ui/default/assets/css/responsive-tables.css" rel="stylesheet" type="text/css" />
	<link href="{{www_path}}/ui/default/assets/css/diy-ui/jquery-ui-1.8.23.custom.css" rel="stylesheet" type="text/css" />

	<!--iOS-->

	<link rel="apple-touch-icon" href="{{img_base_url}}/ui/default/assets/images/invert_logo.png" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />

	<script type="text/javascript">
		var cashAdminPath = "{{www_path}}";
		var currentSection = "{{section_name}}";
		document.write('<style type="text/css">#pagetips {display:none;}.nojs {display:none;}.onlyjs {display:inline;}</style>');
	</script>

	<script src="//www.google.com/jsapi"></script>
	<script src="{{www_path}}/ui/default/assets/scripts/modernizr.foundation.js" type="text/javascript"></script>
	<script src="{{jquery_url}}" type="text/javascript"></script>
	<script src="{{www_path}}/ui/default/assets/scripts/jquery-ui-1.9.0.custom.min.js" type="text/javascript"></script>
	<script src="{{www_path}}/ui/default/assets/scripts/jquery.validate.min.js" type="text/javascript"></script>
</head>
<body id="page" class="off-canvas hide-extras">

<div id="wrap">
	<div id="mainspc" class="login">
						<h1 id="logo"><img src="{{img_base_url}}/ui/default/assets/images/logo.png" alt="CASH Music"/></h1>
		<div id="chromespc">
			<div id="chrome">
				<!--<div id="navmenu">
					<ul>
						<li><a href="http://cashmusic.org/" target="_blank" id="mainnav" class="current"><i class="icon icon-certificate"></i>CASH Music</a></li>
					</ul>
				</div>-->
			</div>
		</div>

		<div id="pagecontent" class="row">
			<div id="pagedisplay">
				<div class="row">
					<div class="six columns">
						{{#reset_message}}
							<span class="highlightcopy">{{reset_message}}</span>
						{{/reset_message}}
						<h3 id="message" {{#login_error}} class="error"{{/login_error}}>{{login_message}}</h3>
						<form method="post" id="cash_signin_form" action="">
							<div class="row">
								<div class="six columns">
									<label for="address">Email address</label>
									<input type="email" name="address" value="" />
								</div>
								<div class="six columns">
									<label for="password">Password</label>
									<input type="password" name="password" value="" />
									<input type="hidden" name="login" value="1" />
									<input type="hidden" id="browseridassertion" name="browseridassertion" value="-1" />
								</div>
							</div>
							
							<div id="loginbuttonspc">
								<a href="#" id="forgotlink">forgot your password?</a><br />
								<button type="submit"><i class='icon icon-signin'></i>log in</button>
							</div>
						</form>
					</div>
				
				</div>

				<div class="row">
					<div class="three columns"></div>
					<div class="six columns">
						<label>Or log in with another service</label>
						<p>
							You can use a third party service to log in. You'll still have an account, but one less password to manage. 
						</p>
						<a href="javascript:void(0)" id="browserid_login_link"><img src="{{img_base_url}}/ui/default/assets/images/browserid.png" alt="log in with browser id" class="cash_browserid_button" /></a>
					</div>
					<div class="three columns"></div>
				</div>
			</div>

			{{{legal_markup}}}

		</div>

	</div>

</div>

<div id="footer" class="login">
	<div class="row">
		<div class="twelve columns">
			<p><b>&copy; 2014 CASH Music.</b> All our code is open-source. <a href="{{www_path}}/licenses/" style="margin-left:0;">Learn more</a>. {{#showterms}}<a href="{{www_path}}/_?showlegal=1">Terms of service</a> {{/showterms}}{{#showprivacy}}<a href="{{www_path}}/_?showlegal=1">Privacy policy</a> {{/showprivacy}}<a href="http://cashmusic.org/#more" class="donatelink"><b>Donate</b></a></p>
		</div>
	</div>
</div>

{{#reset_key}}
	<div class="modalbg surviveload"><div class="modaldialog">
		<div class="row">
			<div class="three columns"></div><div class="six columns">
				<h4>Password reset</h4>Enter a new password. At least {{minimum_password_length}} characters.<br />
				<form action="{{reset_action}}" id="password_reset_form" method="post">
				<input type="hidden" name="finalizepasswordreset" value="go" />
				<input type="hidden" name="key" value="{{reset_key}}" />
				<input type="hidden" name="address" value="{{reset_email}}" />
				<input type="password" id="new_password" name="new_password" autocomplete="off" />
				<label for="toggle_password" style="color:#222;"><input type="checkbox" id="toggle_password" />Reveal text</label>
				<br />
				<input type="button" class="button modalcancel" value="Cancel" />
				<input type="button" id="do_submit" class="button modalyes" value="Change password" />
				</form>
			</div><div class="three columns"></div>	
		</div>
		<script type="text/javascript">
			// http://www.electrictoolbox.com/toggle-password-field-text-password/
			(function() {
				try {
					var p = document.getElementById('new_password');
					p.type = 'text';
					p.type = 'password';

					var toggle = document.getElementById('toggle_password');
					toggle.addEventListener('click', toggleClicked, false);
					toggle.style.display = 'inline';
					
				}
				catch(err) {}
			})();

			function toggleClicked() {
				var p = document.getElementById('new_password');
				var value = p.value;

				if(p.type == 'password') {
					p.type = 'text';
				}
				else {
					p.type = 'password';
				}
				
				p.value = value;
			}

			$('#do_submit').click(function() {
				var n = $('#new_password').val();
				if (n.length < {{minimum_password_length}}) {
					alert('Your password must be at least {{minimum_password_length}} characters.');
				} else {
					$('#password_reset_form').submit();
				}
			});
		</script>
	</div></div>
{{/reset_key}}

{{{browser_id_js}}}

<script type="text/javascript">
	function doEmailSend() {
		// markup for the confirmation link
		var markup = '<div class="modalbg"><div class="modaldialog">' +
					 '<div class="four columns"></div><div class="four columns">' +
					 '<h4>Password reset?</h4>Enter your email, we\'ll send a reset link.<br /><br />' +
					 '<form action="" method="post">' +
					 '<input type="hidden" name="dopasswordresetlink" value="engage" />' +
					 '<input type="text" name="address" value="" placeholder="your email address" />' +
					 '<input type="button" class="button modalcancel" value="Cancel" />' +
					 '<input type="submit" class="button modalyes" value="Send it" />' +
					 '</form>' +
					 '</div><div class="four columns"></div>' +
					 '</div></div>';
		markup = jQuery(markup);
		markup.hide();
		jQuery('body').append(markup);

		// show the dialog with a fast fade-in
		jQuery('.modalbg').fadeIn('fast');
	}

	jQuery('#forgotlink').on('click', function(e) {
		e.preventDefault();
		doEmailSend();
	});

	// overlay cancel button event
	$(document).on('click', '.modalcancel', function(e) {
		e.preventDefault();
		$('.modallightbox').fadeOut('fast', function() {
				$('.modallightbox').remove();
			});
		$('.modalbg').fadeOut('fast', function() {
			$('.modalbg').remove();
		});
	});
</script>
</body>
</html>