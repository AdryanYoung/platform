/**
 * JavaScript behaviors for the CASH admin
 * Copyright (c) 2016, CASH Music
 * See jquery.admin.full.js for full LICENSE
 *
 **/

jQuery.fn.extend({insertAtCaret:function(a){return this.each(function(b){if(document.selection){this.focus();var c=document.selection.createRange();c.text=a,this.focus()}else if(this.selectionStart||"0"==this.selectionStart){var d=this.selectionStart,e=this.selectionEnd,f=this.scrollTop;this.value=this.value.substring(0,d)+a+this.value.substring(e,this.value.length),this.focus(),this.selectionStart=d+a.length,this.selectionEnd=d+a.length,this.scrollTop=f}else this.value+=a,this.focus()})}}),function(a){function b(b){a("#page").hasClass("panel")?(a("#mainspc, #pagetitle, #page").removeClass(function(a,b){return(b.match(/(^|\s)usecolor\S+/g)||[]).join(" ")}),a("#mainspc, #page").addClass(b.specialcolor)):(a("#mainspc, #pagetitle, #page").removeClass(),a("#mainspc, #page").addClass(b.specialcolor)),q(b.section_name),a("#pagemessage").html(""),b.error_message&&y(b.error_message,"Error",!0),b.page_message&&y(b.page_message,""),""!=b.ui_page_tip?(a("#learn_tip").html(b.ui_page_tip),a("#learn_tip").css("display","block")):a("#learn_tip").css("display","none"),a(".panelcontent").html(b.ui_learn_text),a("#page_content").html(b.content),a("#pagetitle span").html(b.ui_title),window.scrollTo(0,0),a(document).trigger("redraw")}function c(f,g,h,i,j){a.ajax({type:"POST",url:f,data:g+"data_only=1",success:function(k){k?(k.initiallogin&&(a("body").removeClass("login"),a("#loadingmask").css("width","1%")),k.template_name&&k.template_name.toLowerCase().indexOf("login")>=0&&(a("body").addClass("login"),history.pushState(1,null,cashAdminPath+"/")),"doredirect"in k||(k.doredirect=!1),k.doredirect?k.showerror?d(k.location,!1,k.showerror):k.showmessage?d(k.location,!1,!1,k.showmessage):d(k.location):(h&&(k.error_message=h),i&&(k.page_message=i),b(k),j||history.pushState(1,null,f),e()),a("#page_content, #ajaxloading, #logo, #hero, #learnpanel, #settingspanel, #helppanel").removeClass("loading")):c(f,g,h,i,j)},error:function(a,b,c){console.log(b+": "+c)},dataType:"json"})}function d(b,d,e,f,g){d?d+="&":d="",a("#panel-filter").val("learn").attr("selected","selected"),a(".modallightbox").fadeOut("fast",function(){a(".modallightbox").remove()}),a(".modalbg").fadeOut("fast",function(){a(".modalbg").remove()}),a("body").hasClass("settings")&&i(),a("#page_content, #ajaxloading, #logo, #hero, #learnpanel, #settingspanel, #helppanel").addClass("loading"),c(b,d,e,f,g)}function e(){a("body").hasClass("settings")&&i(),F('<div class="icon icon-arw-up"></div><!--icon-->Hide','<div class="icon icon-arw-dwn"></div><!--icon-->Show'),G(),a("input[type=date],input.date").datepicker(),p(),t(),r(),j(),l(),x(),localStorage.getItem("resetadminforms")&&!a("body").hasClass("login")&&g(),a("form").garlic(),setTimeout(function(){a(".graph").addClass("loaded")},100)}function f(){m(),s(),u(),I(),w(),H(),k(),J(),a(document).on("click","#tipslink",function(b){b.preventDefault(),a("#pagetips").slideDown(200)}),a(document).on("click","#tipscloselink",function(b){b.preventDefault(),a("#pagetips").slideUp(100)}),a(document).on("swipeleft","#page",function(b){a("body").removeClass("swiperight"),a("body").hasClass("swipeleft")||a("body").hasClass("swiperight")||a("body").addClass("swipeleft")}),a(document).on("swiperight","#page",function(b){a("body").removeClass("swipeleft"),a("body").hasClass("swipeleft")||a("body").hasClass("swiperight")||a("body").addClass("swiperight")}),a(document).on("click","#menutoggle",function(b){a("#menutoggle").toggleClass("display"),a("#navmenu").toggleClass("display")}),a(document).on("click","#searchbtn",function(b){a("#searchbtn").toggleClass("display"),a("#search").toggleClass("display")}),a(document).on("click","a.injectcode",function(b){b.preventDefault(),a("#template")&&a("#template").insertAtCaret("{{{element_"+a(this).data("elementid")+"}}}")}),a(document).on("click","#flipback",function(b){a("#flipback").parent().removeClass("display"),i()}),a(document).on("click",".externalsubmit",function(b){a(a(this).data("cash-target-form")).submit()}),a(document).on("change","#current-campaign",function(b){a(this).closest("form").submit()}),a(document).on("click",".language-switch",function(a){window.location.reload()}),a(document).on("change","#current-published-campaign",function(b){var c=a(this).find(":selected").data("template");c?y("","This will change your public page. Are you sure?",!0,a(this).find(":selected").data("path")):y("","Before you can publish this campaign, you need to set its page theme. Open the campaign and click the edit icon to start.",!0)}),a(document).on("click",".codearea",function(a){if(element=this,document.body.createTextRange){var b=document.body.createTextRange();b.moveToElementText(element),b.select()}else if(window.getSelection){var c=window.getSelection(),b=document.createRange();b.selectNodeContents(element),c.removeAllRanges(),c.addRange(b)}}),a(document).on("click",".multipart-next",function(b){b.preventDefault();var c=!1;a(a(C.form).children(".part-"+C.section)[0]).find("input,select,textarea").each(function(){if(!o.element(a(this)))return c=!0,!1}),c||(a(C.form.children(".part-"+C.section)[0]).hide(),C.section=C.section+1,C.section>C.total?(a(a(C.form).children(".section.basic-information")[0]).fadeIn(),a(C.steps).text("Finalize: "+a(a(C.form).children(".section.basic-information")[0]).data("section-name")),a(C.submit).show()):(a(a(C.form).children(".part-"+C.section)[0]).fadeIn(),a(C.steps).text("Step "+C.section+" of "+C.total+": "+a(a(C.form).children(".part-"+C.section)[0]).data("section-name"))))}),a(document).on("click",".multipart-prev",function(b){b.preventDefault(),a(C.form.children(".part-"+C.section)[0]).hide(),C.section=C.section-1,a(a(C.form).children(".part-"+C.section)[0]).fadeIn(),a(C.steps).text("Step "+C.section+" of "+C.total+": "+a(a(C.form).children(".part-"+C.section)[0]).data("section-name"))}),a(document).on("click",'.store a[href^="'+cashAdminPath+'/elements/add"]',function(b){b.preventDefault(),b.stopPropagation(),jQuery.post(this.href,"data_only=1",function(b){a("div.modallightbox").html('<div class="modal-content"><div class="inner"><h4>'+b.ui_title+"</h4>"+b.content+'<a href="#" class="modalcancel"><div class="icon icon-plus"></div><!--icon--></a><!--modalcancel--></div><!--inner--></div><!--modal-content-->'),a(".store .modallightbox h4").css("width","62%"),a(document).bind("scroll",A),D(),p()},"json")}),a(document).on("click",".revealpassword",function(b){b.preventDefault();a(b.target).prev('input[type="password"]').attr("value");a(b.target).parent().children(".needsreveal").each(function(){var b=a(this).prop("value");"password"==a(this).prop("type")?a(this).attr("type","text"):a(this).attr("type","password"),a(this).attr("value",b)})}),a(document).on("mouseenter",".featured-release",function(b){a("#card",this).addClass("flipped")}),a(document).on("mouseleave",".featured-release",function(b){a("#card",this).removeClass("flipped")}),a(document).on("click",".toggle",function(b){a(this).parent().toggleClass("display")}),a(document).on("click",".paneltitle",function(a){i()}),a(document).on("click","#settings.toggle, #settingspanel .toggle, .settings.toggle",function(b){a("body").removeClass("help").removeClass("learn"),a(this).parents("body").addClass("panel").addClass("settings"),a("#settingspanel .tertiarynav li a").removeClass("current"),h(cashAdminPath+"/account/"),a("#settingspanel .tertiarynav li a:first").addClass("current")}),a(document).on("click","#help.toggle, #helppanel .toggle",function(b){a("body").removeClass("settings").removeClass("learn"),a(this).parents("body").addClass("panel").addClass("help"),a("#helppanel .tertiarynav li a").removeClass("current"),a("#helppanel .tertiarynav li a:first").addClass("current")}),a(document).on("change","#panel-filter",function(b){"faqs"==a("option:selected",this).attr("value")?(a("#panel-filter").val("faqs").attr("selected","selected"),a("body").removeClass("settings").removeClass("learn"),h(cashAdminPath+"/help/")):"learn"==a("option:selected",this).attr("value")?(a("#panel-filter").val("learn").attr("selected","selected"),a(this).parents("body").addClass("learn"),h()):"tour"==a("option:selected",this).attr("value")?(i(),B(a("option:selected",this).attr("href")),a("body").addClass("page-editor")):"http://"==a("option:selected",this).attr("value").substring(0,7)&&window.open(this.value,"_blank")}),a(document).on("click",".swipehint",function(b){a(this).addClass("hide")})}function g(){for(var a=localStorage.length;a--;){var b=localStorage.key(a);b.match(/^garlic/i)&&localStorage.removeItem(b)}localStorage.removeItem("resetadminforms")}function h(b){a.post(b,"data_only=1",function(b){a("body").hasClass("learn")?a(".panelcontent").html(a(b.ui_learn_text)):a("body").hasClass("help")?a("#helppanel .panelcontent").html(a(b.content)):a("body").hasClass("settings")&&a("#settingspanel .panelcontent").html(a(b.content)),p()})}function i(){a("body").removeClass("panel").removeClass("help").removeClass("settings").removeClass("learn")}function j(){if(a("#cnvs").length){var b=a("#cnvs").data("seed");if(b){var c=b.toString().split("").reverse(),d=Math.ceil((Number(c[0])+1)/2),e=Math.ceil((Number(c[1])+1)/2),f=["250,56,102","106,56,250","255,124,18","250,56,56","0,207,127","250,56,102","106,56,250","255,124,18","250,56,56","0,207,127"],g=["0.9","0.6","0.3"],h=[9,24,60,980,120,180,210,240,270,330],i=new Image;i.src=cashAdminPath+"/assets/images/glitch/background/glitch"+d+".jpg",i.addEventListener("load",function(){var b=a("#cnvs").width(),d=a("#cnvs").height(),j=document.getElementById("cnvs").getContext("2d");j.drawImage(i,0,0),olay=new Image,olay.src=cashAdminPath+"/assets/images/glitch/artist/artist"+e+".jpg",olay.addEventListener("load",function(){j.globalCompositeOperation="screen";for(var e=0;e<2e3;)j.drawImage(olay,olay.width/(5*(Number(c[2])+1))+e/3,0,h[Number(c[2])],d,e,0,h[Number(c[2])],d),e+=h[Number(c[2])];j.save(),j.globalCompositeOperation="hard-light";var i=j.createLinearGradient(0,0,a("#cnvs").width()/2,0);i.addColorStop(0,"rgba("+f[Number(c[3])]+","+g[Number(c[3])%3]+")"),i.addColorStop(1,"rgba("+f[Number(c[4])]+","+g[Number(c[3])%3]+")"),j.fillStyle=i,j.fillRect(0,0,b,d),j.restore(),a("#cnvs").addClass("display")},!1)},!1)}}}function k(){a(document).on("mouseenter",".elementdisplay",function(b){if(!a(this).hasClass("injectcode")){b.preventDefault();var c=a(this).attr("name");window.globaltimeout=window.setTimeout(function(){a(".gallery").stop().animate({scrollLeft:Math.floor(a(c).position().left)-34},"slow")},150),a(".example").removeClass("current"),a(".gallery "+c).addClass("current")}}),a(document).on("mouseleave",".elementdisplay",function(a){a.preventDefault(),window.globaltimeout&&window.clearTimeout(window.globaltimeout)})}function l(){ZeroClipboard.config({swfPath:cashAdminPath+"/ui/default/assets/flash/ZeroClipboard.swf"});var b=new ZeroClipboard(a(".copy"));b.on("ready",function(a){b.on("aftercopy",function(a){alert("Embed Code Copied To Clipboard.")})})}function m(){a(document).on("change",".dropdown-nav",function(b){var c=a(b.currentTarget);if(!(b.altKey||b.ctrlKey||b.metaKey||b.shiftKey||c.hasClass("lightboxed")||c.hasClass("needsconfirmation")||c.hasClass("showelementdetails")||c.hasClass("noajax")||c.parents("div").hasClass("inner")||a("body").hasClass("store")||a("body").hasClass("page-editor")||c.hasClass("connection"))){b.preventDefault();var e=a("option:selected").attr("value");d(e)}}),a(document).on("click",'a[href^="'+cashAdminPath+'"]',function(b){var c=a(b.currentTarget);if(b.altKey||b.ctrlKey||b.metaKey||b.shiftKey||c.hasClass("lightboxed")||c.hasClass("needsconfirmation")||c.hasClass("showelementdetails")||c.hasClass("noajax")||c.parents("div").hasClass("inner")||a("body").hasClass("store")||!c.attr("href").indexOf("elements/add")||a("body").hasClass("page-editor")||c.hasClass("connection")||c.parents("div").hasClass(".page-settings-tabs"))if(!c.parents("div").hasClass("inner")||c.hasClass("connection")||c.hasClass("lightboxed")||c.hasClass("needsconfirmation"))c.hasClass("store")?(b.preventDefault(),a("body").addClass("store")):c.hasClass("page-editor")&&(b.preventDefault(),a("body").addClass("page-editor"));else{b.preventDefault(),a(".panelcontent").removeClass("display");var e=c.attr("href");h(e),a(".panelcontent").addClass("display"),a(".inner a").removeClass("current"),c.addClass("current"),c.blur()}else{b.preventDefault();var e=c.attr("href");g(),d(e),c.blur()}})}function n(b){b=a(b);var c=b.attr("action");""==c&&(c=location.pathname);var e=a(b).serialize();b.hasClass("returntocurrentroute")&&(e+="&forceroute="+location.pathname.replace(cashAdminPath,"")),d(c,e)}function p(){a("form").each(function(){var b=a(this);b.hasClass("novalidate")?b.submit(function(a){n(b),a.preventDefault()}):o=b.validate({errorClass:"invalid",errorElement:"span",highlight:function(b,c){a(b).addClass(c),a(b.form).find("label[for="+b.id+"]").addClass(c)},unhighlight:function(b,c){a(b).removeClass(c),a(b.form).find("label[for="+b.id+"]").removeClass(c)},submitHandler:function(b){a(b).attr("action").toLowerCase().indexOf("s3.amazonaws")<1&&!a(b).hasClass("noajax")?n(b):b.submit()}})})}function q(b){b!=currentSection&&(currentSection=b,a("div.mainnavmenu li").each(function(c){a(this).removeClass("current"),a(this).hasClass(b+"nav")&&a(this).addClass("current")}),a("div.mainnavmenu a").each(function(c){a(this).hasClass(b+"nav")&&a(this).parent().addClass("current")}))}function r(){a("#connection_id").each(function(){if(this.value>0){var b=a(".file-upload-trigger").data("upload-endpoint")+this.value;a(".upload-corral").addClass("show").find(".file-upload-trigger").data("upload-endpoint",b)}})}function s(){a(document).on("click","a[data-publicize-endpoint]",function(b){b.preventDefault();a.ajax({url:a(this).data("publicize-endpoint"),dataType:"json"}).done(function(a){}).complete(function(b){var c=a.parseJSON(b.responseText);c.success&&(a("#asset_location").val(c.location),a("#connection_id").val("0"),a(".upload-corral").removeClass("show"))})}),a(document).on("change","#connection_id",function(b){if(console.log(this.value),this.value>0){var c=a(".file-upload-trigger").data("upload-endpoint")+this.value,d=a(".upload-corral").addClass("show").find(".file-upload-trigger");d.data("upload-endpoint",c);a.ajax({url:c,dataType:"json",data:"data_only=1"}).done(function(a){d.parents(".drawer").find(".drawercontent").html(a.content)})}else a(".upload-corral").removeClass("show")}),a(document).on("click",".file-upload-trigger",function(b){b.preventDefault();var e=(a(this),a(this).data("upload-endpoint"),a("#connection_id").val());if(console.log(e),"0"==e)return alert("Sorry, can't upload without a connection. Have you tried a normal link?"),!1})}function t(){a(".autocomplete").each(function(){var b=a(this).data("cash-endpoint-url");a(this).autocomplete({source:function(c,d){a.ajax({url:b+"/"+c.term,dataType:"json",error:function(a){},success:function(b){d(a.map(b,function(a){return{label:a.displayString,value:a.displayString,id:a.id}}))}})},select:function(b,c){a("#event_venue").val(c.item.id)},minLength:2})})}function u(){a(document).on("click",".modalcancel, .modalskip",function(a){a.preventDefault(),v()}),a(document).on("click",".page-description",function(b){a("body").hasClass("settings")||a("body").hasClass("help")?(a("body").removeClass("settings").removeClass("help"),a("body").addClass("learn"),a(this).addClass("display")):a("body").hasClass("learn")?(a("body").removeClass("panel"),window.globaltimeout=window.setTimeout(function(){a("body").removeClass("learn").removeClass("settings").removeClass("help")},250)):(a(this).parents("body").addClass("learn").addClass("panel"),a(this).addClass("display"))}),a(document).keyup(function(a){27===a.keyCode&&v()})}function v(){a(".modallightbox").fadeOut("fast",function(){a(".modallightbox").remove(),openlightbox=!1}),a(".modalbg").fadeOut("fast",function(){a(".modalbg").remove(),a("body").removeClass("store page-editor")}),a(document).unbind("scroll",A)}function w(){a(document).on("click",".needsconfirmation",function(b){b.preventDefault(),a(".modallightbox").remove(),y("","Are you sure?",!0,a(this).attr("href")),this.blur()}),a(document).on("click",".lightboxed",function(b){b.preventDefault(),a(this).hasClass("closepanel")&&i(),a(this).hasClass("returntocurrentroute")?B(a(this).attr("href"),!0):B(a(this).attr("href")),this.blur()})}function x(){a("div.switchblock").each(function(){var b=a(a(this).data("watch"));if(b){var c=a(this).data("change");b.change(function(){a(c).addClass("show")});var d=b.val(),e=a(this).data("special");if(e&&"object"==typeof e)if(e.val){if(d==e.val&&a(e.target))return a(e.target).addClass("show"),b.change(function(){a(e.target).removeClass("show")}),!0}else a.each(e,function(c,e){if(d==e.val&&a(e.target))return a(e.target).addClass("show"),b.change(function(){a(e.target).removeClass("show")}),!0});var f=a(this).data("default");a(f).addClass("show"),f!==c&&b.change(function(){a(f).removeClass("show")})}})}function y(b,c,e,f){var g='<div class="modalbg"><div class="modaldialog"><div class="pure-u-1"><p><span class="big">'+c+"</span></p><br />";b&&(g+='<p><span class="big">'+b+"</span></p>"),e&&f&&(g+='<input type="button" class="button modalcancel" value="Cancel" /><input type="button" class="button modalyes" value="Yes do it" />'),e&&!f&&(g+='<input type="button" class="button modalyes" value="OK" />'),g+="</div><!--pure--></div></div>",g=a(g),g.hide(),a("body").append(g),e?a(".modalyes").on("click",function(b){b.preventDefault(),f&&d(f,"modalconfirm=1&redirectto="+location.pathname.replace(cashAdminPath,"")),a(".modalbg").remove()}):window.setTimeout(function(){a(".modalbg").remove()},2e3),a(".modalbg").fadeIn("fast")}function A(){a(document).scrollTop()<z&&(z=a(document).scrollTop(),z<0&&(z=0),a(".modallightbox").css("top",z+"px"))}function B(b,c){jQuery.post(b,"data_only=1",function(b){var d="";c&&(d="returntocurrentroute ");var e=a(".modallightbox").length;if(e){var f="<h4>"+b.ui_title+"</h4>"+b.content+'<a href="#" class="modalcancel"><div class="icon icon-plus"></div><!--icon--></a>';a(".modallightbox").html(f)}else{var f='<div class="modalbg"></div><div class="modallightbox '+d+'"><div class="modal-content"><div class="inner"><h4>'+b.ui_title+"</h4>"+b.content+'<div class="tar" style="position:relative;z-index:9876;"><a href="#" class="modalcancel"><div class="icon icon-plus"></div><!--icon--></a></div></div><!--inner--></div><!--modal-content--></div><!--modallightbox-->';f=a(f),f.hide(),a("body").append(f),F('<i class="icon icon-chevron-sign-up"></i>Hide','<i class="icon icon-chevron-sign-down"></i>Show'),z=a(document).scrollTop(),a(".modallightbox").css("top",z+"px")}l(),a(document).bind("scroll",A),D(),e?(p(),G()):(a(".modalbg").fadeIn("fast"),a(".modallightbox").fadeIn("fast",function(){p(),G()}))},"json")}function D(){C.section=1,a(".modallightbox form.multipart").each(function(){C.form=a(this),C.submit=a(this).children("input[type=submit]")[0],C.total=a(this).data("parts"),a(".modallightbox form.multipart div.section").each(function(){a(this).hasClass("part-"+C.section)&&C.total||a(this).hide()}),C.steps=a('<h5 class="steps">Step 1 of '+C.total+": "+a(a(C.form).children(".part-"+C.section)[0]).data("section-name")+"</h5>"),C.total?a(C.submit).hide():(a(a(C.form).children(".section.basic-information")[0]).fadeIn(),a(C.steps).text("Finalize: "+a(a(C.form).children(".section.basic-information")[0]).data("section-name"))),C.steps.insertBefore(a(this));for(var b=1;b<=C.total;b++)E(b)})}function E(b){var c=a('<div class="row"></div>'),d=a('<div class="twelve columns"></div>');if(a(c).append(d),b<=C.total){if(b==C.total)var e="Next";else var e="Next";b>1&&a(d).append(a('<button class="button multipart-prev">Previous</button> ')),a(d).append('<button class="button multipart-next">'+e+"</button>"),a(a(C.form).children(".part-"+b)[0]).append(c)}}function F(b,c,d,e){a(".drawer-trigger").on("click",function(){a(document.body).animate({scrollTop:a("#settings-drawer").offset().top},1e3)}),a(".drawer").each(function(){var f,g,h,i;if(f=a(this),0==f.find(".drawerhandleaction").length){if(f.hasClass("noprefix")?(a.data(f,"labelTextHidden",""),a.data(f,"labelTextVisible","")):(a.data(f,"labelTextHidden",c),a.data(f,"labelTextVisible",b)),g=f.find(".drawerhandle"),h=f.find(".drawercontent"),drawerNav=f.find(".page-settings-tabs"),drawerNavLink=f.find(".page-settings-tabs li"),drawerSection=f.find(".pref-inner"),i=a('<span class="drawerhandleaction">'+a.data(f,"labelTextHidden")+" </span>"),d&&i.addClass(e),f.hasClass("multipart")){var j=0;drawerNavLink.eq(j).addClass("current"),drawerSection.eq(j).addClass("active"),drawerNavLink.on("click",function(){var a=drawerNavLink.index(this),b=a;drawerNavLink.removeClass("current")&&drawerSection.removeClass("active"),drawerNavLink.eq(b).addClass("current")&&drawerSection.eq(b).addClass("active")})}f.hasClass("defaultopen")||f.hasClass("open")||h.hide(),g.prepend(i),a(this).find(".drawerhandle").add(".drawer-trigger").on("click",function(){f.addClass("open"),a(this).blur(),h.is(":hidden")?h.slideDown(200,function(){i.html(a.data(f,"labelTextVisible")+" "),d&&(i.removeClass(),i.addClass(d)),f.hasClass("multipart")&&(drawerNavLink.eq(0).addClass("current"),drawerSection.eq(0).addClass("active"))}):(f.removeClass("open"),f.hasClass("multipart")&&(drawerNavLink.removeClass("current"),drawerSection.removeClass("active")),h.slideUp(200,function(){h.hide(),i.html(a.data(f,"labelTextHidden")+" "),e&&(i.removeClass(),i.addClass(e))}))})}})}function G(){a("div.scalar").each(function(b){a(this).hide();var c=a('<a href="#" class="clonebutton"><i class="icon icon-circle-plus"></i>'+a(this).data("actiontext")+"</a>"),d=a(this).html(),e=0+Number(a(this).data("clonecount")),f=a(this).data("name"),g=a(this).nextAll("div.clonedscalar");g.length?g.last().after(c):a(this).after(c),c.click(function(b){b.preventDefault();var c=a('<div class="clonedscalar">'+d+"</div>");c.find("*").each(function(){a(this).attr("name")&&(a(this).attr("name",a(this).attr("name")+"-clone-"+f+"-"+e),a(this).attr("id",a(this).attr("id")+"-clone-"+f+"-"+e))}),e++;var g=a('<a href="#" class="removescalar"><div class="icon icon-plus"></div></a>');c.append(g),a(this).before(c)})})}function H(){a(document).on("click","a.removescalar",function(b){b.preventDefault();var c=a(this).parent(".clonedscalar");c.fadeOut(400,function(){c.detach()})})}function I(){a(document).on("keydown","textarea.taller",function(b){if(9===b.keyCode){var c=this.selectionStart;end=this.selectionEnd;var d=a(this);return d.val(d.val().substring(0,c)+"\t"+d.val().substring(end)),this.selectionStart=this.selectionEnd=c+1,!1}})}function J(){a(document).on("input","form.add_variants #primary_variant_name",function(b){var c=a("#primary_variant_name").val();c?(a("form.add_variants div.variant1").addClass("pure-u-md-1-2"),a("form.add_variants div.variant2").css("display","inline-block"),a("form.add_variants .findreplace").each(function(){a(this).data("startvalue").indexOf("[primary_variant_name]")!==-1&&a(this).text(a(this).data("startvalue").replace("[primary_variant_name]",c))})):(a("form.add_variants div.variant1").removeClass("pure-u-md-1-2"),a("form.add_variants div.variant2").css("display","none"))}),a(document).on("input","form.add_variants #secondary_variant_name",function(b){var c=a("#secondary_variant_name").val();c?(a("form.add_variants div.variant1-options").addClass("pure-u-md-1-2"),a("form.add_variants div.variant2-options").css("display","inline-block"),a("form.add_variants .findreplace").each(function(){a(this).data("startvalue").indexOf("[secondary_variant_name]")!==-1&&a(this).text(a(this).data("startvalue").replace("[secondary_variant_name]",c))})):(a("form.add_variants div.variant1-options").removeClass("pure-u-md-1-2"),a("form.add_variants div.variant2-options").css("display","none"))})}a(document).ready(function(){f(),e(),FastClick.attach(document.body),window.globaltimeout=!1,history.pushState(1,null,location.pathname),window.addEventListener("popstate",function(a){a.state&&d(location.pathname,null,null,null,!0)},!1)});var o,z=0,C={form:null,section:1,total:0,submit:null,steps:null}}(jQuery);