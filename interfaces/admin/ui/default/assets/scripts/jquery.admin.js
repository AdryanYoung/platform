/**
 * JavaScript behaviors for the CASH admin
 * Copyright (c) 2016, CASH Music
 * See jquery.admin.full.js for full LICENSE
 *
 **/

jQuery.fn.extend({insertAtCaret:function(e){return this.each(function(t){if(document.selection){this.focus();var a=document.selection.createRange();a.text=e,this.focus()}else if(this.selectionStart||"0"==this.selectionStart){var n=this.selectionStart,s=this.selectionEnd,i=this.scrollTop;this.value=this.value.substring(0,n)+e+this.value.substring(s,this.value.length),this.focus(),this.selectionStart=n+e.length,this.selectionEnd=n+e.length,this.scrollTop=i}else this.value+=e,this.focus()})}}),function(e){function t(t){e("#page").hasClass("panel")?(e("#mainspc, #pagetitle, #page").removeClass(function(e,t){return(t.match(/(^|\s)usecolor\S+/g)||[]).join(" ")}),e("#mainspc, #page").addClass(t.specialcolor)):(e("#mainspc, #pagetitle, #page").removeClass(),e("#mainspc, #page").addClass(t.specialcolor)),f(t.section_name),e("#pagemessage").html(""),t.error_message&&_(t.error_message,"Error",!0),t.page_message&&_(t.page_message,""),""!=t.ui_page_tip?(e("#learn_tip").html(t.ui_page_tip),e("#learn_tip").css("display","block")):e("#learn_tip").css("display","none"),e(".panelcontent").html(t.ui_learn_text),e("#page_content").html(t.content),e("#pagetitle span").html(t.ui_title),window.scrollTo(0,0),e(document).trigger("redraw")}function a(i,o,l,r,d){e.ajax({type:"POST",url:i,data:o+"data_only=1",success:function(c){c?(c.initiallogin&&(e("body").removeClass("login"),e("#loadingmask").css("width","1%")),c.template_name&&c.template_name.toLowerCase().indexOf("login")>=0&&(e("body").addClass("login"),history.pushState(1,null,cashAdminPath+"/")),"doredirect"in c||(c.doredirect=!1),c.doredirect?c.showerror?n(c.location,!1,c.showerror):c.showmessage?n(c.location,!1,!1,c.showmessage):n(c.location):(l&&(c.error_message=l),r&&(c.page_message=r),t(c),d||history.pushState(1,null,i),s()),e("#page_content, #ajaxloading, #logo, #hero, #learnpanel, #settingspanel, #helppanel").removeClass("loading")):a(i,o,l,r,d)},error:function(e,t,a){console.log(t+": "+a)},dataType:"json"})}function n(t,n,s,i,o){n?n+="&":n="",e("#panel-filter").val("learn").attr("selected","selected"),e(".modallightbox").fadeOut("fast",function(){e(".modallightbox").remove()}),e(".modalbg").fadeOut("fast",function(){e(".modalbg").remove()}),e("body").hasClass("settings")&&r(),e("#page_content, #ajaxloading, #logo, #hero, #learnpanel, #settingspanel, #helppanel").addClass("loading"),a(t,n,s,i,o)}function s(){e("body").hasClass("settings")&&r(),D('<div class="icon icon-arw-up"></div><!--icon-->Hide','<div class="icon icon-arw-dwn"></div><!--icon-->Show'),N(),e("input[type=date],input.date").datepicker(),m(),b(),v(),d(),u(),x(),localStorage.getItem("resetadminforms")&&!e("body").hasClass("login")&&o(),e("form").garlic(),setTimeout(function(){e(".graph").addClass("loaded")},100)}function i(){p(),g(),C(),I(),w(),O(),c(),A(),e(document).on("click","#tipslink",function(t){t.preventDefault(),e("#pagetips").slideDown(200)}),e(document).on("click","#tipscloselink",function(t){t.preventDefault(),e("#pagetips").slideUp(100)}),e(document).on("swipeleft","#page",function(t){e("body").removeClass("swiperight"),e("body").hasClass("swipeleft")||e("body").hasClass("swiperight")||e("body").addClass("swipeleft")}),e(document).on("swiperight","#page",function(t){e("body").removeClass("swipeleft"),e("body").hasClass("swipeleft")||e("body").hasClass("swiperight")||e("body").addClass("swiperight")}),e(document).on("click","#menutoggle",function(t){e("#menutoggle").toggleClass("display"),e("#navmenu").toggleClass("display")}),e(document).on("click","#searchbtn",function(t){e("#searchbtn").toggleClass("display"),e("#search").toggleClass("display")}),e(document).on("click","a.injectcode",function(t){t.preventDefault(),e("#template")&&e("#template").insertAtCaret("{{{element_"+e(this).data("elementid")+"}}}")}),e(document).on("click","#flipback",function(t){e("#flipback").parent().removeClass("display"),r()}),e(document).on("click",".externalsubmit",function(t){e(e(this).data("cash-target-form")).submit()}),e(document).on("change","#current-campaign",function(t){e(this).closest("form").submit()}),e(document).on("change","#current-published-campaign",function(t){var a=e(this).find(":selected").data("template");a?_("","This will change your public page. Are you sure?",!0,e(this).find(":selected").data("path")):_("","Before you can publish this campaign, you need to set its page theme. Open the campaign and click the edit icon to start.",!0)}),e(document).on("click",".codearea",function(e){if(element=this,document.body.createTextRange){var t=document.body.createTextRange();t.moveToElementText(element),t.select()}else if(window.getSelection){var a=window.getSelection(),t=document.createRange();t.selectNodeContents(element),a.removeAllRanges(),a.addRange(t)}}),e(document).on("click",".multipart-next",function(t){t.preventDefault();var a=!1;e(e(E.form).children(".part-"+E.section)[0]).find("input,select,textarea").each(function(){return L.element(e(this))?void 0:(a=!0,!1)}),a||(e(E.form.children(".part-"+E.section)[0]).hide(),E.section=E.section+1,E.section>E.total?(e(e(E.form).children(".section.basic-information")[0]).fadeIn(),e(E.steps).text("Finalize: "+e(e(E.form).children(".section.basic-information")[0]).data("section-name")),e(E.submit).show()):(e(e(E.form).children(".part-"+E.section)[0]).fadeIn(),e(E.steps).text("Step "+E.section+" of "+E.total+": "+e(e(E.form).children(".part-"+E.section)[0]).data("section-name"))))}),e(document).on("click",".multipart-prev",function(t){t.preventDefault(),e(E.form.children(".part-"+E.section)[0]).hide(),E.section=E.section-1,e(e(E.form).children(".part-"+E.section)[0]).fadeIn(),e(E.steps).text("Step "+E.section+" of "+E.total+": "+e(e(E.form).children(".part-"+E.section)[0]).data("section-name"))}),e(document).on("click",'.store a[href^="'+cashAdminPath+'/elements/add"]',function(t){t.preventDefault(),t.stopPropagation(),jQuery.post(this.href,"data_only=1",function(t){e("div.modallightbox").html("<h4>"+t.ui_title+"</h4>"+t.content+'<div class="tar" style="position:relative;z-index:9876;"><a href="#" class="modalcancel smalltext"><div class="icon icon-plus"></div><!--icon--></a></div>'),e(".store .modallightbox h4").css("width","62%"),e(document).bind("scroll",k),T(),m()},"json")}),e(document).on("click",".revealpassword",function(t){t.preventDefault();e(t.target).prev('input[type="password"]').attr("value");e(t.target).parent().children(".needsreveal").each(function(){var t=e(this).prop("value");"password"==e(this).prop("type")?e(this).attr("type","text"):e(this).attr("type","password"),e(this).attr("value",t)})}),e(document).on("mouseenter",".featured-release",function(t){e("#card",this).addClass("flipped")}),e(document).on("mouseleave",".featured-release",function(t){e("#card",this).removeClass("flipped")}),e(document).on("click",".toggle",function(t){e(this).parent().toggleClass("display")}),e(document).on("click",".paneltitle",function(e){r()}),e(document).on("click","#settings.toggle, #settingspanel .toggle, .settings.toggle",function(t){e("body").removeClass("help").removeClass("learn"),e(this).parents("body").addClass("panel").addClass("settings"),e("#settingspanel .tertiarynav li a").removeClass("current"),l(cashAdminPath+"/account/"),e("#settingspanel .tertiarynav li a:first").addClass("current")}),e(document).on("click","#help.toggle, #helppanel .toggle",function(t){e("body").removeClass("settings").removeClass("learn"),e(this).parents("body").addClass("panel").addClass("help"),e("#helppanel .tertiarynav li a").removeClass("current"),e("#helppanel .tertiarynav li a:first").addClass("current")}),e(document).on("change","#panel-filter",function(t){"faqs"==e("option:selected",this).attr("value")?(e("#panel-filter").val("faqs").attr("selected","selected"),e("body").removeClass("settings").removeClass("learn"),l(cashAdminPath+"/help/")):"learn"==e("option:selected",this).attr("value")?(e("#panel-filter").val("learn").attr("selected","selected"),e(this).parents("body").addClass("learn"),l()):"tour"==e("option:selected",this).attr("value")?(r(),S(e("option:selected",this).attr("href")),e("body").addClass("page-editor")):"http://"==e("option:selected",this).attr("value").substring(0,7)&&window.open(this.value,"_blank")}),e(document).on("click",".swipehint",function(t){e(this).addClass("hide")})}function o(){for(var e=localStorage.length;e--;){var t=localStorage.key(e);t.match(/^garlic/i)&&localStorage.removeItem(t)}localStorage.removeItem("resetadminforms")}function l(t){e.post(t,"data_only=1",function(t){e("body").hasClass("learn")?e(".panelcontent").html(e(t.ui_learn_text)):e("body").hasClass("help")?e("#helppanel .panelcontent").html(e(t.content)):e("body").hasClass("settings")&&e("#settingspanel .panelcontent").html(e(t.content)),m()})}function r(){e("body").removeClass("panel").removeClass("help").removeClass("settings").removeClass("learn")}function d(){if(e("#cnvs").length){var t=e("#cnvs").data("seed");if(t){var a=t.toString().split("").reverse(),n=Math.ceil((Number(a[0])+1)/2),s=Math.ceil((Number(a[1])+1)/2),i=["250,56,102","106,56,250","255,124,18","250,56,56","0,207,127","250,56,102","106,56,250","255,124,18","250,56,56","0,207,127"],o=["0.9","0.6","0.3"],l=[9,24,60,980,120,180,210,240,270,330],r=new Image;r.src=cashAdminPath+"/assets/images/glitch/background/glitch"+n+".jpg",r.addEventListener("load",function(){var t=e("#cnvs").width(),n=e("#cnvs").height(),d=document.getElementById("cnvs").getContext("2d");d.drawImage(r,0,0),olay=new Image,olay.src=cashAdminPath+"/assets/images/glitch/artist/artist"+s+".jpg",olay.addEventListener("load",function(){d.globalCompositeOperation="screen";for(var s=0;2e3>s;)d.drawImage(olay,olay.width/(5*(Number(a[2])+1))+s/3,0,l[Number(a[2])],n,s,0,l[Number(a[2])],n),s+=l[Number(a[2])];d.save(),d.globalCompositeOperation="hard-light";var r=d.createLinearGradient(0,0,e("#cnvs").width()/2,0);r.addColorStop(0,"rgba("+i[Number(a[3])]+","+o[Number(a[3])%3]+")"),r.addColorStop(1,"rgba("+i[Number(a[4])]+","+o[Number(a[3])%3]+")"),d.fillStyle=r,d.fillRect(0,0,t,n),d.restore(),e("#cnvs").addClass("display")},!1)},!1)}}}function c(){e(document).on("mouseenter",".elementdisplay",function(t){if(!e(this).hasClass("injectcode")){t.preventDefault();var a=e(this).attr("name");window.globaltimeout=window.setTimeout(function(){e(".gallery").stop().animate({scrollLeft:Math.floor(e(a).position().left)-34},"slow")},150),e(".example").removeClass("current"),e(".gallery "+a).addClass("current")}}),e(document).on("mouseleave",".elementdisplay",function(e){e.preventDefault(),window.globaltimeout&&window.clearTimeout(window.globaltimeout)})}function u(){ZeroClipboard.config({swfPath:cashAdminPath+"/ui/default/assets/flash/ZeroClipboard.swf"});var t=new ZeroClipboard(e(".copy"));t.on("ready",function(e){t.on("aftercopy",function(e){alert("Embed Code Copied To Clipboard.")})})}function p(){e(document).on("change",".dropdown-nav",function(t){var a=e(t.currentTarget);if(!(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey||a.hasClass("lightboxed")||a.hasClass("needsconfirmation")||a.hasClass("showelementdetails")||a.hasClass("noajax")||a.parents("div").hasClass("inner")||e("body").hasClass("store")||e("body").hasClass("page-editor")||a.hasClass("connection"))){t.preventDefault();var s=e("option:selected").attr("value");n(s)}}),e(document).on("click",'a[href^="'+cashAdminPath+'"]',function(t){var a=e(t.currentTarget);if(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey||a.hasClass("lightboxed")||a.hasClass("needsconfirmation")||a.hasClass("showelementdetails")||a.hasClass("noajax")||a.parents("div").hasClass("inner")||e("body").hasClass("store")||!a.attr("href").indexOf("elements/add")||e("body").hasClass("page-editor")||a.hasClass("connection")||a.parents("div").hasClass(".page-settings-tabs"))if(!a.parents("div").hasClass("inner")||a.hasClass("connection")||a.hasClass("lightboxed")||a.hasClass("needsconfirmation"))a.hasClass("store")?(t.preventDefault(),e("body").addClass("store")):a.hasClass("page-editor")&&(t.preventDefault(),e("body").addClass("page-editor"));else{t.preventDefault(),e(".panelcontent").removeClass("display");var s=a.attr("href");l(s),e(".panelcontent").addClass("display"),e(".inner a").removeClass("current"),a.addClass("current"),a.blur()}else{t.preventDefault();var s=a.attr("href");o(),n(s),a.blur()}})}function h(t){t=e(t);var a=t.attr("action");""==a&&(a=location.pathname);var s=e(t).serialize();t.hasClass("returntocurrentroute")&&(s+="&forceroute="+location.pathname.replace(cashAdminPath,"")),n(a,s)}function m(){e("form").each(function(){var t=e(this);t.hasClass("novalidate")?t.submit(function(e){h(t),e.preventDefault()}):L=t.validate({errorClass:"invalid",errorElement:"span",highlight:function(t,a){e(t).addClass(a),e(t.form).find("label[for="+t.id+"]").addClass(a)},unhighlight:function(t,a){e(t).removeClass(a),e(t.form).find("label[for="+t.id+"]").removeClass(a)},submitHandler:function(t){e(t).attr("action").toLowerCase().indexOf("s3.amazonaws")<1&&!e(t).hasClass("noajax")?h(t):t.submit()}})})}function f(t){t!=currentSection&&(currentSection=t,e("div.mainnavmenu li").each(function(a){e(this).removeClass("current"),e(this).hasClass(t+"nav")&&e(this).addClass("current")}),e("div.mainnavmenu a").each(function(a){e(this).hasClass(t+"nav")&&e(this).parent().addClass("current")}))}function v(){e("#connection_id").each(function(){if(this.value>0){var t=e(".file-upload-trigger").data("upload-endpoint")+this.value;e(".upload-corral").fadeIn().find(".file-upload-trigger").data("upload-endpoint",t)}})}function g(){e(document).on("click","a[data-publicize-endpoint]",function(t){t.preventDefault();e.ajax({url:e(this).data("publicize-endpoint"),dataType:"json"}).done(function(e){}).complete(function(t){var a=e.parseJSON(t.responseText);a.success&&(e("#asset_location").val(a.location),e("#connection_id").val("0"),e(".upload-corral").fadeOut())})}),e(document).on("change","#connection_id",function(t){if(this.value>0){var a=e(".file-upload-trigger").data("upload-endpoint")+this.value,n=e(".upload-corral").fadeIn().find(".file-upload-trigger");n.data("upload-endpoint",a);e.ajax({url:a,dataType:"json",data:"data_only=1"}).done(function(e){n.parents(".drawer").find(".drawercontent").html(e.content)})}else e(".upload-corral").fadeOut()}),e(document).on("click",".file-upload-trigger",function(t){t.preventDefault();var a=e(this),n=(e(this).data("upload-endpoint"),e("#connection_id").val());return"0"==n?(alert("Sorry, can't upload without a connection. Have you tried a normal link?"),!1):(a.parents(".fadedtext").css("height","0px"),void a.parents(".fadedtext").animate({opacity:0}))})}function b(){e(".autocomplete").each(function(){var t=e(this).data("cash-endpoint-url");e(this).autocomplete({source:function(a,n){e.ajax({url:t+"/"+a.term,dataType:"json",error:function(e){},success:function(t){n(e.map(t,function(e){return{label:e.displayString,value:e.displayString,id:e.id}}))}})},select:function(t,a){e("#event_venue").val(a.item.id)},minLength:2})})}function C(){e(document).on("click",".modalcancel, .modalskip",function(e){e.preventDefault(),y()}),e(document).on("click",".page-description",function(t){e("body").hasClass("settings")||e("body").hasClass("help")?(e("body").removeClass("settings").removeClass("help"),e("body").addClass("learn"),e(this).addClass("display")):e("body").hasClass("learn")?(e("body").removeClass("panel"),window.globaltimeout=window.setTimeout(function(){e("body").removeClass("learn").removeClass("settings").removeClass("help")},250)):(e(this).parents("body").addClass("learn").addClass("panel"),e(this).addClass("display"))}),e(document).keyup(function(e){27===e.keyCode&&y()})}function y(){e(".modallightbox").fadeOut("fast",function(){e(".modallightbox").remove(),openlightbox=!1}),e(".modalbg").fadeOut("fast",function(){e(".modalbg").remove(),e("body").removeClass("store page-editor")}),e(document).unbind("scroll",k)}function w(){e(document).on("click",".needsconfirmation",function(t){t.preventDefault(),e(".modallightbox").remove(),_("","Are you sure?",!0,e(this).attr("href")),this.blur()}),e(document).on("click",".lightboxed",function(t){t.preventDefault(),e(this).hasClass("closepanel")&&r(),e(this).hasClass("returntocurrentroute")?S(e(this).attr("href"),!0):S(e(this).attr("href")),this.blur()})}function x(){e("div.switchblock").each(function(){var t=e(e(this).data("watch"));if(t){var a=e(this).data("change");t.change(function(){e(a).addClass("show")});var n=t.val(),s=e(this).data("special");if(s&&"object"==typeof s)if(s.val){if(n==s.val&&e(s.target))return e(s.target).addClass("show"),t.change(function(){e(s.target).removeClass("show")}),!0}else e.each(s,function(a,s){return n==s.val&&e(s.target)?(e(s.target).addClass("show"),t.change(function(){e(s.target).removeClass("show")}),!0):void 0});var i=e(this).data("default");e(i).addClass("show"),i!==a&&t.change(function(){e(i).removeClass("show")})}})}function _(t,a,s,i){var o='<div class="modalbg"><div class="modaldialog"><div class="pure-u-1"><p><span class="big">'+a+"</span></p><br />";t&&(o+='<p><span class="big">'+t+"</span></p>"),s&&i&&(o+='<input type="button" class="button modalcancel" value="Cancel" /><input type="button" class="button modalyes" value="Yes do it" />'),s&&!i&&(o+='<input type="button" class="button modalyes" value="OK" />'),o+="</div><!--pure--></div></div>",o=e(o),o.hide(),e("body").append(o),s?e(".modalyes").on("click",function(t){t.preventDefault(),i&&n(i,"modalconfirm=1&redirectto="+location.pathname.replace(cashAdminPath,"")),e(".modalbg").remove()}):window.setTimeout(function(){e(".modalbg").remove()},2e3),e(".modalbg").fadeIn("fast")}function k(){e(document).scrollTop()<P&&(P=e(document).scrollTop(),0>P&&(P=0),e(".modallightbox").css("top",P+"px"))}function S(t,a){jQuery.post(t,"data_only=1",function(t){var n="";a&&(n="returntocurrentroute ");var s=e(".modallightbox").length;if(s){var i="<h4>"+t.ui_title+"</h4>"+t.content+'<div class="tar" style="position:relative;z-index:9876;"><a href="#" class="modalcancel smalltext"><div class="icon icon-plus"></div><!--icon--></a></div>';e(".modallightbox").html(i)}else{var i='<div class="modalbg">&nbsp;</div><div class="modallightbox '+n+'"><h4>'+t.ui_title+"</h4>"+t.content+'<div class="tar" style="position:relative;z-index:9876;"><a href="#" class="modalcancel smalltext"><div class="icon icon-plus"></div><!--icon--></a></div></div></div>';i=e(i),i.hide(),e("body").append(i),D('<i class="icon icon-chevron-sign-up"></i>Hide','<i class="icon icon-chevron-sign-down"></i>Show'),P=e(document).scrollTop(),e(".modallightbox").css("top",P+"px")}u(),e(document).bind("scroll",k),T(),s?(m(),N()):(e(".modalbg").fadeIn("fast"),e(".modallightbox").fadeIn("fast",function(){m(),N()}))},"json")}function T(){E.section=1,e(".modallightbox form.multipart").each(function(){E.form=e(this),E.submit=e(this).children("input[type=submit]")[0],E.total=e(this).data("parts"),e(".modallightbox form.multipart div.section").each(function(){e(this).hasClass("part-"+E.section)&&E.total||e(this).hide()}),E.steps=e('<h5 class="steps">Step 1 of '+E.total+": "+e(e(E.form).children(".part-"+E.section)[0]).data("section-name")+"</h5>"),E.total?e(E.submit).hide():(e(e(E.form).children(".section.basic-information")[0]).fadeIn(),e(E.steps).text("Finalize: "+e(e(E.form).children(".section.basic-information")[0]).data("section-name"))),E.steps.insertBefore(e(this));for(var t=1;t<=E.total;t++)j(t)})}function j(t){var a=e('<div class="row"></div>'),n=e('<div class="twelve columns"></div>');if(e(a).append(n),t<=E.total){if(t==E.total)var s="Next";else var s="Next";t>1&&e(n).append(e('<button class="button multipart-prev">Previous</button> ')),e(n).append('<button class="button multipart-next">'+s+"</button>"),e(e(E.form).children(".part-"+t)[0]).append(a)}}function D(t,a,n,s){e(".drawer-trigger").on("click",function(){e(document.body).animate({scrollTop:e("#settings-drawer").offset().top},1e3)}),e(".drawer").each(function(){var i,o,l,r;if(i=e(this),0==i.find(".drawerhandleaction").length){if(i.hasClass("noprefix")?(e.data(i,"labelTextHidden",""),e.data(i,"labelTextVisible","")):(e.data(i,"labelTextHidden",a),e.data(i,"labelTextVisible",t)),o=i.find(".drawerhandle"),l=i.find(".drawercontent"),drawerNav=i.find(".page-settings-tabs"),drawerNavLink=i.find(".page-settings-tabs li"),drawerSection=i.find(".pref-inner"),r=e('<span class="drawerhandleaction">'+e.data(i,"labelTextHidden")+" </span>"),n&&r.addClass(s),i.hasClass("multipart")){var d=0;drawerNavLink.eq(d).addClass("current"),drawerSection.eq(d).addClass("active"),drawerNavLink.on("click",function(){var e=drawerNavLink.index(this),t=e;drawerNavLink.removeClass("current")&&drawerSection.removeClass("active"),drawerNavLink.eq(t).addClass("current")&&drawerSection.eq(t).addClass("active")})}i.hasClass("defaultopen")||i.hasClass("open")||l.hide(),o.prepend(r),e(this).find(".drawerhandle").add(".drawer-trigger").on("click",function(){i.addClass("open"),e(this).blur(),l.is(":hidden")?l.slideDown(200,function(){r.html(e.data(i,"labelTextVisible")+" "),n&&(r.removeClass(),r.addClass(n)),i.hasClass("multipart")&&(drawerNavLink.eq(0).addClass("current"),drawerSection.eq(0).addClass("active"))}):(i.removeClass("open"),i.hasClass("multipart")&&(drawerNavLink.removeClass("current"),drawerSection.removeClass("active")),l.slideUp(200,function(){l.hide(),r.html(e.data(i,"labelTextHidden")+" "),s&&(r.removeClass(),r.addClass(s))}))})}})}function N(){e("div.scalar").each(function(t){e(this).hide();var a=e('<a href="#" class="clonebutton"><i class="icon icon-circle-plus"></i>'+e(this).data("actiontext")+"</a>"),n=e(this).html(),s=0+Number(e(this).data("clonecount")),i=e(this).data("name"),o=e(this).nextAll("div.clonedscalar");o.length?o.last().after(a):e(this).after(a),a.click(function(t){t.preventDefault();var a=e('<div class="clonedscalar">'+n+"</div>");a.find("*").each(function(){e(this).attr("name")&&(e(this).attr("name",e(this).attr("name")+"-clone-"+i+"-"+s),e(this).attr("id",e(this).attr("id")+"-clone-"+i+"-"+s))}),s++;var o=e('<a href="#" class="removescalar"><div class="icon icon-plus"></div></a>');a.append(o),e(this).before(a)})})}function O(){e(document).on("click","a.removescalar",function(t){t.preventDefault();var a=e(this).parent(".clonedscalar");a.fadeOut(400,function(){a.detach()})})}function I(){e(document).on("keydown","textarea.taller",function(t){if(9===t.keyCode){var a=this.selectionStart;end=this.selectionEnd;var n=e(this);return n.val(n.val().substring(0,a)+"	"+n.val().substring(end)),this.selectionStart=this.selectionEnd=a+1,!1}})}function A(){e(document).on("input","form.add_variants #primary_variant_name",function(t){var a=e("#primary_variant_name").val();a?(e("form.add_variants div.variant1").addClass("pure-u-md-1-2"),e("form.add_variants div.variant2").css("display","inline-block"),e("form.add_variants .findreplace").each(function(){-1!==e(this).data("startvalue").indexOf("[primary_variant_name]")&&e(this).text(e(this).data("startvalue").replace("[primary_variant_name]",a))})):(e("form.add_variants div.variant1").removeClass("pure-u-md-1-2"),e("form.add_variants div.variant2").css("display","none"))}),e(document).on("input","form.add_variants #secondary_variant_name",function(t){var a=e("#secondary_variant_name").val();a?(e("form.add_variants div.variant1-options").addClass("pure-u-md-1-2"),e("form.add_variants div.variant2-options").css("display","inline-block"),e("form.add_variants .findreplace").each(function(){-1!==e(this).data("startvalue").indexOf("[secondary_variant_name]")&&e(this).text(e(this).data("startvalue").replace("[secondary_variant_name]",a))})):(e("form.add_variants div.variant1-options").removeClass("pure-u-md-1-2"),e("form.add_variants div.variant2-options").css("display","none"))})}e(document).ready(function(){i(),s(),FastClick.attach(document.body),window.globaltimeout=!1,history.pushState(1,null,location.pathname),window.addEventListener("popstate",function(e){e.state&&n(location.pathname,null,null,null,!0)},!1)});var L,P=0,E={form:null,section:1,total:0,submit:null,steps:null}}(jQuery);
