window.cashmusic=function(){"use strict";var e;if(null!=window.cashmusic)e=window.cashmusic;else{e={embeds:{whitelist:"",all:[]},embedded:!1,eventlist:{},geo:null,get:{},lightbox:!1,loaded:!1,name:"",options:"",path:"",scripts:[],sessionid:null,soundplayer:!1,storage:{},templates:{},_init:function(){var e=window.cashmusic;if(e.get.qs=window.location.search.substring(1),e.get.params=!1,e.get.qs){e.get.params={};for(var t,s=e.get.qs.split("&"),n=0;n<s.length;n++)t=s[n].split("="),e.get.params[t[0]]=decodeURIComponent(t[1])}e.get.params.debug&&(e.debug.show=!0),self!==top?e._initEmbed():e.name="main window",e.session.start();var o=document.querySelectorAll("a.cashmusic.gallery,div.cashmusic.gallery");if((-1!==e.options.indexOf("lightboxvideo")||o.length>0)&&e.loadScript(e.path+"/lightbox/lightbox.js"),document.querySelectorAll("a.cashmusic.soundplayer,div.cashmusic.soundplayer").length>0&&e.loadScript(e.path+"/soundplayer/soundplayer.js"),e.events.add(window,"message",function(t){-1!==e.embeds.whitelist.indexOf(t.origin)&&e._handleMessage(t)}),e.embeds.whitelist+=window.location.href.split("/").slice(0,3).join("/"),e.get.params.location&&(e.embeds.whitelist+=e.get.params.location.split("/").slice(0,3).join("/")),e.embedded)e.loaded=Date.now(),e._drawQueuedEmbeds(),e.debug.store("session id set: "+e.sessionid),e.debug.show&&e.debug.out("finished initializing",e),e.events.fire(e,"ready",e.loaded);else{e.get.qs&&(-1===e.get.qs.indexOf("element_id")&&-1===e.get.qs.indexOf("handlequery")||window.history&&history.pushState&&history.pushState(null,null,window.location.href.split("?")[0])),e.overlay.create();var i=0,n=setInterval(function(){i<50&&(!e.geo||!e.sessionid&&-1===e.options.indexOf("standalone"))?i++:(e.sessionid?e.debug.store("session id set: "+e.sessionid):e.debug.store("no session. standalone mode."),e.debug.store("geo acquired: "+e.geo),e.debug.store("total delay: "+100*i+"ms"),e.loaded=Date.now(),clearInterval(n),e._drawQueuedEmbeds(),e.debug.show&&e.debug.out("finished initializing",e),e.events.fire(e,"ready",e.loaded))},100)}},_drawQueuedEmbeds:function(){var e=window.cashmusic;"object"==typeof e.storage.elementQueue&&e.storage.elementQueue.forEach(function(t){e.embed(t[0],t[1],t[2],t[3],t[4],t[5])})},_initEmbed:function(){var e=window.cashmusic;e.embedded=!0;var t=document.querySelector("div.cashmusic.element");if(t){e.storage.embedheight=e.measure.scrollheight(),e.events.fire(e,"resize",e.storage.embedheight);var s=t.className.split(" ");e.events.fire(e,"identify",[s[2],s[3].substr(3)]),e.name="element #"+s[3].substr(3)+" / "+s[2],window.setInterval(function(){var t=e.measure.scrollheight();t!=e.storage.embedheight&&(e.storage.embedheight=t,e.events.fire(e,"resize",t))},250);var n=e.getQueryVariable("cssoverride");n&&e.styles.injectCSS(n,!0)}for(var o=document.getElementsByTagName("form"),i=0;i<o.length;i++){var a=document.createElement("input");a.setAttribute("type","hidden"),a.setAttribute("name","embedded_element"),a.setAttribute("value","1"),o[i].appendChild(a)}},_handleMessage:function(e){for(var t,s=window.cashmusic,n=JSON.parse(e.data),o=n.data,i=0;i<s.embeds.all.length;i++)if(s.embeds.all[i].el.contentWindow===e.source){t=s.embeds.all[i];break}var a=!1;if(o.target)for(i=0;i<s.embeds.all.length;i++)if(s.embeds.all[i].id==o.target){a=s.embeds.all[i].el.contentWindow;break}switch(n.type){case"resize":t.el.height=o,t.el.style.height=o+"px";break;case"identify":t.id==o[1]&&(t.type=o[0]);break;case"checkoutdata":s.events.fire(s,"checkoutdata",o);break;case"overlayreveal":s.overlay.reveal(o.innerContent,o.wrapClass),s.events.fire(s,"overlayopened","");break;case"overlayhide":s.overlay.hide(),s.events.fire(s,"overlayhidden","");break;case"addoverlaytrigger":s.overlay.addOverlayTrigger(o.content,o.classname,o.ref);break;case"injectcss":s.styles.injectCSS(o.css,o.important);break;case"addclass":s.styles.addClass(o.el,o.classname);break;case"removeclass":s.styles.removeClass(o.el,o.classname);break;case"swapclasses":s.styles.swapClasses(o.el,o.oldclass,o.newclass);break;case"begincheckout":var d=a;d||(d=e.source),s.checkout?(s.checkout.begin(o,d),a=!1):(s.loadScript(s.path+"/checkout/checkout.js",function(){s.checkout.begin(o,d)}),a=!1)}a&&s.events.fire(s,n.type,o,a)},contentLoaded:function(t){var s=!1,n=!0,o=window.document,i=o.documentElement,a=function(n){"readystatechange"==n.type&&"complete"!=o.readyState||(e.events.remove("load"==n.type?window:o,n.type,a),!s&&(s=!0)&&t.call(window,n.type||n))},d=function(){try{i.doScroll("left")}catch(e){return void setTimeout(d,50)}a("poll")};if("complete"==o.readyState)t.call(window,"lazy");else{if(o.createEventObject&&i.doScroll){try{n=!window.frameElement}catch(e){}n&&d()}this.events.add(o,"DOMContentLoaded",a),this.events.add(o,"readystatechange",a),this.events.add(o,"load",a)}},embed:function(e,t,s,n,o,i){var a=window.cashmusic;"string"==typeof e&&("h"!=e.substr(0,1)&&"/"!=e.substr(0,1)||(e=[t,t=e][0]));var d=document.querySelectorAll("script"),r=d[d.length-1];if(a.loaded){"object"==typeof e&&(s=!!e.lightboxed&&e.lightboxed,n=!!e.lightboxtxt&&e.lightboxtxt,o=!!e.targetnode&&e.targetnode,i=!!e.cssoverride&&e.cssoverride,t=!!e.endpoint&&e.endpoint,e=!!e.elementid&&e.elementid),r="string"==typeof o?document.querySelector(o):o,t||(t=a.path);var c=a.buildEmbedIframe(t,e,i,!!s&&"lightbox=1");if(r)if(s){var l=document.createElement("span");l.className="cashmusic embed link",n||(n="open element"),a.overlay.create(function(){var e=document.createElement("a");e.href="",e.target="_blank",e.innerHTML=n,l.appendChild(e),r.parentNode.insertBefore(l,r),a.events.add(e,"click",function(e){return a.overlay.reveal(c),e.preventDefault(),!1})})}else r.parentNode.insertBefore(c,r)}else"object"!=typeof a.storage.elementQueue&&(a.storage.elementQueue=[]),"object"==typeof e?e.targetnode||(e.targetnode=r,arguments[0]=e):arguments[4]=r,a.storage.elementQueue.push(arguments)},buildEmbedIframe:function(e,t,s,n){var o=window.cashmusic,i=e.replace(/\/$/,"")+"/request/embed/"+t+"?location="+encodeURIComponent(window.location.href);o.geo&&(i+="&geo="+encodeURIComponent(o.geo)),s&&(i+="&cssoverride="+encodeURIComponent(s)),n&&(i+="&"+n),o.get.params&&-1===(""+n).indexOf("lightbox=1")&&(o.get.params.element_id==t||o.get.params.handlequery)&&(i+="&"+o.get.qs),o.sessionid&&(i+="&session_id="+o.sessionid),o.debug.show&&(i+="&debug=1");var a=document.createElement("iframe");a.src=i,a.id="cm-"+(new Date).getTime(),a.className="cashmusic embed",a.style.width="100%",a.style.height="0",a.style.border="0",a.style.overflow="hidden",a.scrolling="no";var d=i.split("/").slice(0,3).join("/");return-1===o.embeds.whitelist.indexOf(d)&&(o.embeds.whitelist=o.embeds.whitelist+d),o.embeds.all.push({el:a,id:t,type:""}),o.debug.store("building iframe for element #"+t),a},getTemplate:function(e,t){var s=window.cashmusic,n=s.templates;void 0!==n[e]?t(n[e]):(this.ajax.jsonp(s.path+"/templates/"+e+".js","callback",function(s){n[e]=s.template,t(s.template)},"cashmusic"+e+"Callback"),document.querySelectorAll('link[href="'+s.path+"/templates/"+e+'.css"]').length||s.styles.injectCSS(s.path+"/templates/"+e+".css"))},addEventListener:function(e,t){var s=window.cashmusic;s.eventlist.hasOwnProperty(e)||(s.eventlist[e]=[]),s.eventlist[e].push(t)},removeEventListener:function(e,t){var s=window.cashmusic;if(s.eventlist.hasOwnProperty(e)){var n=s.eventlist[e].indexOf(t);-1!=n&&s.eventlist[e].splice(n,1)}},dispatchEvent:function(e){var t=window.cashmusic;if(t.eventlist.hasOwnProperty(e.type)){var s;for(s=0;s<t.eventlist[e.type].length;s++)t.eventlist[e.type][s]&&t.eventlist[e.type][s](e)}},loadScript:function(e,t){var s=window.cashmusic;if(s.scripts.indexOf(e)>-1)"function"==typeof t&&t();else{s.scripts.push(e);var n=document.getElementsByTagName("head")[0]||document.documentElement,o=document.createElement("script");o.src=e;var i=!1;o.onload=o.onreadystatechange=function(){i||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(i=!0,"function"==typeof t&&t(),o.onload=o.onreadystatechange=null,n&&o.parentNode&&n.removeChild(o))},n.insertBefore(o,n.firstChild)}s.debug.show&&(s.loaded?s.debug.out("loaded script: "+e):s.debug.store("loaded script: "+e))},getQueryVariable:function(e){for(var t=window.location.search.substring(1).split("&"),s=0;s<t.length;s++){var n=t[s].split("=");if(n[0]==e)return decodeURIComponent(n[1])}return!1},debug:{show:!1,store:function(e,t){var s=window.cashmusic;s.storage.debug||(s.storage.debug=[]),s.storage.debug.push({msg:e,o:t})},out:function(e,t){var s=window.cashmusic;s.storage.debug?(console.groupCollapsed("%cⓃ "+s.name+": "+e,"color: #FF00FF;"),t&&console.log("   attachment: %o",t),s.storage.debug.forEach(function(e){e.o?console.log("   "+e.msg+" %o",e.o):console.log("   "+e.msg)}),console.groupEnd(),delete s.storage.debug):t?console.log("%cⓃ "+s.name+": "+e+" %o","color: #FF00FF;",t):console.log("%cⓃ "+s.name+": "+e,"color: #FF00FF;")}},ajax:{getXHR:function(){try{return new XMLHttpRequest}catch(e){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return!1}}}},send:function(e,t,s,n){var o=window.cashmusic,i="POST";t?o.sessionid&&(t+="&session_id="+o.sessionid):(i="GET",t=null,o.sessionid&&(-1===e.indexOf("?")?e+="?session_id="+o.sessionid:e+="&session_id="+o.sessionid));var a=this.getXHR();a&&(a.open(i,e,!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),"POST"==i&&a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),"function"==typeof s&&(a.onreadystatechange=function(){4===a.readyState&&(200===a.status?s(a.responseText):"function"==typeof n&&n(a.responseText))}),a.send(t))},jsonp:function(e,t,s,n){if(e=e||"",t=t||"",s=s||function(){},n=n||!1,"function"==typeof t&&(s=t,t="callback"),n){var o=n,i=function(){};"function"==typeof window[o]&&(i=window[o])}else o="jsonp"+Math.round(1000001*Math.random());window[o]=function(e){s(e),n?i(e):delete window[o]},-1===e.indexOf("?")?e+="?":e+="&";var a=document.createElement("script");a.setAttribute("src",e+t+"="+o),document.getElementsByTagName("head")[0].appendChild(a)},encodeForm:function(e){if("object"!=typeof e)return!1;var t="";e=e.elements||e;for(var s=0;s<e.length;s++)"checkbox"!==e[s].type&&"radio"!==e[s].type?t+=(t.length?"&":"")+encodeURIComponent(e[s].name)+"="+encodeURIComponent(e[s].value):e[s].checked&&(t+=(t.length?"&":"")+encodeURIComponent(e[s].name)+"="+encodeURIComponent(e[s].value));return t},getHeaderForURL:function(e,t,s){var n=this.getXHR();n.open("HEAD",e),n.onreadystatechange=function(){this.readyState==this.DONE&&s(this.getResponseHeader(t))},n.send()}},events:{add:function(e,t,s){e.attachEvent?(e["e"+t+s]=s,e[t+s]=function(){e["e"+t+s](window.event)},e.attachEvent("on"+t,e[t+s])):e.addEventListener(t,s,!1)},remove:function(e,t,s){e.detachEvent?(e.detachEvent("on"+t,e[t+s]),e[t+s]=null):e.removeEventListener(t,s,!1)},fire:function(e,t,s,n){var o=window.cashmusic;if(n&&n.postMessage(JSON.stringify({type:t,data:s}),"*"),document.dispatchEvent)(i=document.createEvent("CustomEvent")).initCustomEvent(t,!1,!1,s),e.dispatchEvent(i);else{var i=document.createEventObject();i.detail=s,e.fireEvent("on"+t,i)}o.embedded&&o.events.relay(t,s),o.debug.show&&(o.loaded?o.debug.out("firing "+t+" event.",s):o.debug.store("firing "+t+" event.",s))},relay:function(e,t){window.parent.postMessage(JSON.stringify({type:e,data:t}),"*")}},session:{start:function(){var e=window.cashmusic;if(!e.sessionid&&-1===e.options.indexOf("standalone"))if(e.get.params.session_id)e.sessionid=e.get.params.session_id;else e.session.getid(window.location.href.split("/").slice(0,3).join("/"))},setid:function(e){var t=window.cashmusic,s=e;if(t.sessionid=s.id,!t.embedded)try{var n=localStorage.getItem("sessions");(n=n?JSON.parse(n):{})[window.location.href.split("/").slice(0,3).join("/")]={id:s.id,expiration:s.expiration},localStorage.setItem("sessions",JSON.stringify(n))}catch(e){}},getid:function(e){var t=window.cashmusic;if(t.sessionid||t.get.params.session_id&&(t.sessionid=t.get.params.session_id),!t.sessionid&&!t.embedded){var s=!1;try{s=localStorage.getItem("sessions")}catch(e){s=!1}s&&(s=JSON.parse(s))[e]&&(s[e].expiration>Math.floor((new Date).getTime()/1e3)?t.sessionid=s[e].id:(delete s[e],localStorage.setItem("sessions",JSON.stringify(s))))}if(null===t.sessionid&&!t.embedded&&-1===t.options.indexOf("standalone")){t.sessionid=!1;var n=t.path.replace("public","api")+"/verbose/system/startjssession";n+="?ts="+(new Date).getTime(),t.ajax.send(n,!1,function(e){if(e){var s=JSON.parse(e);t.session.setid(s.payload),t.events.fire(t,"sessionstarted",s.payload)}},function(e){t.options+=" standalone"})}return t.sessionid}},measure:{viewport:function(){return{x:window.innerWidth||document.body.offsetWidth||0,y:window.innerHeight||document.body.offsetHeight||0}},scrollheight:function(){var e=document.body,t=document.documentElement;return Math.max(e.scrollHeight,t.scrollHeight,e.offsetHeight,t.offsetHeight,e.clientHeight,t.clientHeight)}},overlay:{content:!1,close:!1,callbacks:[],create:function(e){var t=window.cashmusic,s=t.overlay;t.styles.injectCSS(t.path+"/templates/overlay.css"),s.content=document.createElement("div"),s.content.className="cm-overlay",s.close=document.createElement("div"),s.close.className="cm-close",t.events.add(window,"keyup",function(e){27==e.keyCode&&s.content.parentNode==document.body&&s.hide()}),t.events.add(s.close,"click",function(e){s.content.parentNode==document.body&&s.hide()}),"function"==typeof e&&e()},hide:function(){var e=window.cashmusic,t=e.overlay,s=document.body;if(e.embedded)e.events.fire(e,"overlayhide");else{for(t.content.style.opacity=0,e.events.fire(e,"overlayclosed","");t.content.firstChild;)t.content.removeChild(t.content.firstChild);s.removeChild(t.close),s.removeChild(t.content);var n=document.querySelectorAll(".cm-overlaytrigger");if(n.length>0)for(var o=0,i=n.length;o<i;o++)n[o].style.visibility="visible";e.styles.removeClass(document.documentElement,"cm-noscroll")}},reveal:function(e,t){var s=window.cashmusic,n=s.overlay,o=document.body;if(s.embedded)s.events.fire(s,"overlayreveal",{innerContent:e,wrapClass:t});else{1==n.content.style.opacity&&(n.content.innerHTML="");var i=document.createElement("div");i.className="cm-position";var a=document.createElement("div");if(a.className=t||"cm-element","string"==typeof e)a.innerHTML=e;else if(e.endpoint&&e.element){var d="";s.sessionid&&(d="&session_id="+s.sessionid);var r=s.buildEmbedIframe(e.endpoint,e.element,!1,"lightbox=1&state="+e.state+d);a.appendChild(r)}else a.appendChild(e);i.appendChild(a),n.content.appendChild(i),s.styles.hasClass(document.documentElement,"cm-noscroll")||s.styles.addClass(document.documentElement,"cm-noscroll"),1!=n.content.style.opacity&&(n.content.style.opacity=0,o.appendChild(n.content),o.appendChild(n.close),window.getComputedStyle(n.content).opacity,n.content.style.opacity=1)}},addOverlayTrigger:function(e,t,s){var n=window.cashmusic,o=(n.overlay,document.body);if(n.embedded)n.events.fire(n,"addoverlaytrigger",{content:e,classname:t,ref:s});else{var i=document.createElement("div");i.className=t.toString()+" cm-overlaytrigger",n.events.add(i,"click",function(t){return n.overlay.reveal(e),this.style.visibility="hidden",t.preventDefault(),!1}),o.appendChild(i),n.storage[s]=i,n.events.fire(n,"triggeradded",s)}}},styles:{resolveElement:function(e){return"string"==typeof e?"storage:"==e.substr(0,8)?window.cashmusic.storage[e.substr(8)]:document.querySelector(e):e},addClass:function(e,t,s){var n=window.cashmusic;s&&n.embedded?n.events.fire(n,"addclass",{el:e,classname:t}):(e=n.styles.resolveElement(e))&&(e.className=e.className+" "+t)},hasClass:function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>-1},injectCSS:function(e,t,s){void 0===s&&(s=!1);var n=window.cashmusic;if(s&&n.embedded)n.events.fire(n,"injectcss",{css:e,important:t});else{var o=document.getElementsByTagName("head")[0]||document.documentElement;if("http"==e.substr(0,4))(i=document.createElement("link")).rel="stylesheet",i.href=e;else{var i=document.createElement("style");i.innerHTML=e}i.type="text/css",t?o.appendChild(i):o.insertBefore(i,o.firstChild)}},removeClass:function(e,t,s){var n=window.cashmusic;s&&n.embedded?n.events.fire(n,"removeclass",{el:e,classname:t}):(e=n.styles.resolveElement(e))&&(e.className=(" "+e.className+" ").replace(" "+t+" "," ").replace(/^\s+/,"").replace(/\s+$/,""))},swapClasses:function(e,t,s,n){var o=window.cashmusic;n&&o.embedded?o.events.fire(o,"swapclasses",{el:e,oldclass:t,newclass:s}):(e=o.styles.resolveElement(e))&&(e.className=(" "+e.className+" ").replace(" "+t+" "," "+s+" ").replace(/^\s+/,"").replace(/\s+$/,""))}}};var t=document.querySelector('script[src$="cashmusic.js"]');t&&(e.path=t.src.substr(0,t.src.length-13)),e.options=String(t.getAttribute("data-options")),self===top&&e.ajax.getHeaderForURL("https://javascript-cashmusic.netdna-ssl.com/cashmusic.js","GeoIp-Data",function(t){e.geo=t});var s=function(){var t=document.querySelectorAll('script[src$="cashmusic.js"]');"object"==typeof t&&Array.prototype.slice.call(t).forEach(function(t){var s=t.getAttribute("data-element");s&&e.embed({elementid:s,targetnode:t})})};e.contentLoaded(function(){-1!==e.options.indexOf("lazy")?setTimeout(function(){e._init(e),s()},1e3):(e._init(e),s())})}return e}();