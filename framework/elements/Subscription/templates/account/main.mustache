<div class="cm-sub-logo"></div>

<div id="cm-subscription-feed">

    <div class="account-settings">
        <a href="#" class="feed-button cm-logout">Logout</a>
        <a href="#" class="feed-button cm-feed">Return to feed</a>

    </div>

    <h1 class="cm-success-title">Account Settings</h1>

    {{#form_result}}
        <div class="cm-subscription-message">
            <p>{{form_result}}</p>
        </div>
    {{/form_result}}
    <div class="main-settings">
    {{#address}}
    <h3>Shipping Address</h3>
    <p>
        <strong>{{customer_shipping_name}}</strong><br>
        {{customer_address1}}<br>
        {{#customer_address2}}
            {{customer_address2}}<br>
        {{/customer_address2}}
        {{customer_city}}, {{customer_region}} {{customer_postalcode}} {{customer_countrycode}}
    </p>
    {{/address}}

    <a href="#" class="feed-button cm-address">Update Address</a>
        <div class="clear"></div>

    <h3>Subscription settings</h3>

    <p><strong>Status</strong> {{subscriber.status}}</p>
    <p><strong>Member since </strong> {{subscriber.start_date}}</p>

    <p><strong>Payment source</strong> {{customer.brand}} ending in {{customer.last_four}}, expires {{customer.expiry}} </p>
        <p><strong>Contribution</strong> {{currency}}{{customer.payment}}/per {{customer.interval}}</p>
        <div class="clear"></div>
        <a href="#" class="feed-button cm-billing">Change payment source</a>
    <a href="#" class="feed-button cm-amount">Change contribution amount</a>
        <div class="clear"></div>

    <p><strong>Next renewal date</strong> {{customer.expires}}</p>
      <a href="#" class="feed-button cm-cancel">Cancel my subscription</a>

    </div>

</div>

{{> account/partials/confirm }}

<script type="text/javascript">

    var cm = window.cashmusic;

    cm.events.add(cm,'ready', function(e) {

        cm.session.start();
        cm.session.setid({"id":"{{session_id}}"});

        var feed = document.querySelector('.cm-feed');
        var logout = document.querySelector('.cm-logout');

        var address = document.querySelector('.cm-address');
        var cancel = document.querySelector('.cm-cancel');


        if (feed) {
            cm.events.add(feed, 'click', function (e) {
                e.preventDefault();
                cm.overlay.reveal({"element":"{{element_id}}","endpoint":"{{public_url}}","state":"logged_in_index"});
            });
        }

        if (logout) {
            cm.events.add(logout, 'click', function (e) {
                e.preventDefault();
                cm.overlay.reveal({"element":"{{element_id}}","endpoint":"{{public_url}}","state":"logout"});
            });
        }

        if (address) {
            cm.events.add(address, 'click', function (e) {
                e.preventDefault();
                cm.overlay.reveal({"element":"{{element_id}}","endpoint":"{{public_url}}","state":"account_address"});
            });
        }

        if (cancel) {

            document.getElementById("modal_message").innerText = "Are you sure you want to cancel?";

            cm.events.add(cancel, 'click', function (e) {
                document.getElementById("modal_dialog").style.visibility = "visible";
            });

            cm.events.add(document.querySelector('.confirm-true'), 'click', function (e) {
                e.preventDefault();
                document.getElementById("modal_dialog").style.visibility = "hidden";
                cm.overlay.reveal({"element":"{{element_id}}","endpoint":"{{public_url}}","state":"cancel"});

            });

            cm.events.add(document.querySelector('.confirm-false'), 'click', function (e) {
                e.preventDefault()
                document.getElementById("modal_dialog").style.visibility = "hidden";
            });
        }

    });

</script>